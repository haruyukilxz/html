{"attributes":{"title":"使用webpack打包Vue和TypeScript","date":"2019-10-22T15:20:08.000Z","tags":["Vue","Webpack","TypeScript"],"categories":"Web"},"body":"本文将会介绍如何通过Webpack将基于TypeScript的Vue项目进行打包。\r\n## webpack基础配置\r\n首先创建一个基本的webpack.config.js文件:\r\n```\r\nconst path = require( 'path' );\r\nmodule.exports = {\r\n    entry: {\r\n        index: \"./src/index.ts\",\r\n    },\r\n    output: {\r\n        path: path.resolve( __dirname, 'dist' ),\r\n        publicPath: '/dist/',\r\n        filename: '[name].js'\r\n    },\r\n    devtool: 'inline-source-map',\r\n    mode: 'development',\r\n    module: {\r\n        rules: [\r\n        ]\r\n    },\r\n    resolve: {\r\n    }\r\n};\r\n```\r\n此时webpack只能将src/index.ts文件直接输出为index.js，我们需要添加typescript的loader，进行typescript的转换。\r\n将以下代码加入rules节:\r\n```\r\n{\r\n    test: /\\.ts?$/,\r\n    loader: 'ts-loader',\r\n    exclude: /node_modules/,\r\n},\r\n```\r\n通过ts-loader进行ts文件的转换，我们还需要创建typescript的一个配置文件。\r\n## 添加typescript支持\r\n创建tsconfig.json\r\n```\r\n{\r\n    \"compilerOptions\": {\r\n        \"outDir\": \"./dist/\",\r\n        \"sourceMap\": true,\r\n        \"strict\": true,\r\n        \"module\": \"commonjs\",\r\n        \"moduleResolution\": \"node\",\r\n        \"target\": \"es5\",\r\n        \"skipLibCheck\": true,\r\n        \"esModuleInterop\": true,\r\n        \"experimentalDecorators\": true\r\n    },\r\n    \"include\": [\r\n        \"./src/**/*\"\r\n    ]\r\n}\r\n```\r\n还需要在webpack的配置中添加ts文件，在resolve节中添加:\r\n```\r\nextensions: [ '.ts', '.js' ],\r\n```\r\n我们指定ts转换出的js代码是es5的。\r\n这个时候我们运行webpack，将会看到正常的转换输出。\r\n```\r\nHash: c3a0ae2c47032de12eec\r\nVersion: webpack 4.41.0\r\nTime: 1880ms\r\nBuilt at: 10/22/2019 3:40:59 PM\r\n   Asset      Size  Chunks             Chunk Names\r\nindex.js  11.8 KiB   index  [emitted]  index\r\nEntrypoint index = index.js\r\n[./src/index.ts] 269 bytes {index} [built]\r\n```\r\n入口文件就是index.ts了，之后我们就正常的在index.ts中写我们的代码，webpack就会查找所有的依赖，并打包输出到index.js中。\r\n## 添加Vue单文件的支持\r\nVue单文件组件(SFC)规范是指在一个文件中，提供html、css和script代码，三者包含在顶级语言块 `<template>`、`<script>` 和 `<style>`\r\n 中，还允许添加可选的自定义块。\r\n这是一个简单的vue单文件例子:\r\n```\r\n<template>\r\n  <div class=\"example\">{{ msg }}</div>\r\n</template>\r\n<script>\r\nexport default {\r\n  data () {\r\n    return {\r\n      msg: 'Hello world!'\r\n    }\r\n  }\r\n}\r\n</script>\r\n<style>\r\n.example {\r\n  color: red;\r\n}\r\n</style>\r\n<custom1>\r\n  This could be e.g. documentation for the component.\r\n</custom1>\r\n```\r\n我们通过vue-loader来解析该文件，提取每一个语言块，如有需要，会传递给其他loader进行处理，最后组装为一个ES Module。\r\n我们在webpack的rules节中添加vue-loader:\r\n```\r\n{\r\n  test: /\\.vue$/,\r\n  loader: 'vue-loader',\r\n  options: {\r\n    loaders: {\r\n      // Since sass-loader (weirdly) has SCSS as its default parse mode, we map\r\n      // the \"scss\" and \"sass\" values for the lang attribute to the right configs here.\r\n      // other preprocessors should work out of the box, no loader config like this necessary.\r\n      'scss': 'vue-style-loader!css-loader!sass-loader',\r\n      'sass': 'vue-style-loader!css-loader!sass-loader?indentedSyntax',\r\n    }\r\n    // other vue-loader options go here\r\n  }\r\n},\r\n```\r\n## 如果vue是typescript代码？\r\n其实这很简单，ts-loader有一个appendTsSuffixTo的功能，可以给某个文件增加.ts的后缀，从而识别这个文件为ts文件。\r\n```\r\n{\r\n  test: /\\.tsx?$/,\r\n  loader: 'ts-loader',\r\n  exclude: /node_modules/,\r\n  options: {\r\n    appendTsSuffixTo: [/\\.vue$/],\r\n  }\r\n},\r\n```\r\n我们还需要在项目中添加一个vue-shim.d.ts来让ts正确的识别vue。\r\n```\r\ndeclare module '*.vue' {\r\n  import Vue from 'vue'\r\n  export default Vue\r\n}\r\n```\r\n还需要在webpack的resolve节追加vue的后缀:\r\n```\r\nresolve: {\r\n  extensions: [ '.tsx', '.ts', '.js' , '.vue'],\r\n  alias: {\r\n    'vue': 'vue/dist/vue.js'\r\n  }\r\n},\r\n```\r\nvue-loader现在需要手动处理一下插件，在webpack.config.js的头部导入vue-loader，并在plugins节创建对象。\r\n```\r\nconst { VueLoaderPlugin } = require('vue-loader')\r\n.......\r\nplugins: [\r\n  new VueLoaderPlugin()\r\n],\r\n```\r\n否则将不能正确工作。\r\n此时已经完成了webpack+vue+typescript的全部工作。\r\n```\r\nHash: 320d4ed3f55f52872694\r\nVersion: webpack 4.41.0\r\nTime: 2494ms\r\nBuilt at: 10/22/2019 4:00:50 PM\r\n      Asset       Size    Chunks             Chunk Names\r\n  bundle.js   1.12 MiB    bundle  [emitted]  bundle\r\nelectron.js   12.2 KiB  electron  [emitted]  electron\r\n index.html  194 bytes            [emitted]\r\nEntrypoint bundle = bundle.js\r\nEntrypoint electron = electron.js\r\n[./node_modules/css-loader/dist/cjs.js!./node_modules/vue-loader/lib/loaders/stylePostLoader.js!./node_modules/sass-loader/dist/cjs.js!./node_modules/vue-loader/lib/index.js?!./src/app.vue?vue&type=style&index=0&id=5ef48958&rel=stylesheet%2Fscss&lang=scss&scoped=true&] ./node_modules/css-loader/dist/cjs.js!./node_modules/vue-loader/lib/loaders/stylePostLoader.js!./node_modules/sass-loader/dist/cjs.js!./node_modules/vue-loader/lib??vue-loader-options!./src/app.vue?vue&type=style&index=0&id=5ef48958&rel=stylesheet%2Fscss&lang=scss&scoped=true& 542 bytes {bundle} [built]\r\n[./node_modules/ts-loader/index.js?!./node_modules/vue-loader/lib/index.js?!./src/Components/About.vue?vue&type=script&lang=ts&] ./node_modules/ts-loader??ref--1!./node_modules/vue-loader/lib??vue-loader-options!./src/Components/About.vue?vue&type=script&lang=ts& 305 bytes {bundle} [built]\r\n[./node_modules/vue-loader/lib/loaders/templateLoader.js?!./node_modules/vue-loader/lib/index.js?!./src/Components/About.vue?vue&type=template&id=aa9c95a6&] ./node_modules/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!./node_modules/vue-loader/lib??vue-loader-options!./src/Components/About.vue?vue&type=template&id=aa9c95a6& 235 bytes {bundle} [built]\r\n[./node_modules/vue-loader/lib/loaders/templateLoader.js?!./node_modules/vue-loader/lib/index.js?!./src/app.vue?vue&type=template&id=5ef48958&scoped=true&] ./node_modules/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!./node_modules/vue-loader/lib??vue-loader-options!./src/app.vue?vue&type=template&id=5ef48958&scoped=true& 589 bytes {bundle} [built]\r\n[./node_modules/vue-style-loader/index.js!./node_modules/css-loader/dist/cjs.js!./node_modules/vue-loader/lib/loaders/stylePostLoader.js!./node_modules/sass-loader/dist/cjs.js!./node_modules/vue-loader/lib/index.js?!./src/app.vue?vue&type=style&index=0&id=5ef48958&rel=stylesheet%2Fscss&lang=scss&scoped=true&] ./node_modules/vue-style-loader!./node_modules/css-loader/dist/cjs.js!./node_modules/vue-loader/lib/loaders/stylePostLoader.js!./node_modules/sass-loader/dist/cjs.js!./node_modules/vue-loader/lib??vue-loader-options!./src/app.vue?vue&type=style&index=0&id=5ef48958&rel=stylesheet%2Fscss&lang=scss&scoped=true& 1.64 KiB {bundle} [built]\r\n[./src/Components/About.vue] 1.06 KiB {bundle} [built]\r\n[./src/Components/About.vue?vue&type=script&lang=ts&] 350 bytes {bundle} [built]\r\n[./src/Components/About.vue?vue&type=template&id=aa9c95a6&] 203 bytes {bundle} [built]\r\n[./src/app.vue] 1.08 KiB {bundle} [built]\r\n[./src/app.vue?vue&type=style&index=0&id=5ef48958&rel=stylesheet%2Fscss&lang=scss&scoped=true&] 716 bytes {bundle} [built]\r\n[./src/app.vue?vue&type=template&id=5ef48958&scoped=true&] 207 bytes {bundle} [built]\r\n[./src/entry.ts] 538 bytes {bundle} [built]\r\n[./src/main.ts] 1.11 KiB {electron} [built]\r\n[./src/route.ts] 1.35 KiB {bundle} [built]\r\n```\r\n\r\n","id":"eb5e31eba4260e2683ba9964334c8cba","link":"/2019/10/22/使用webpack打包Vue和TypeScript"}